<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Image Book Reader</title>
  <meta name="description" content="Flip through a book made of images. Keyboard, touch, and smooth animations." />
  <style>
    :root{
      --bg:#0d1117;
      --panel:#161b22;
      --text:#e6edf3;
      --muted:#8b949e;
      --accent:#58a6ff;
      --accent-2:#7ee787;
      --danger:#ff7b72;
      --shadow:rgba(0,0,0,.4);
      --page-w: min(820px, 92vw);
      --page-h: calc(var(--page-w) * 1.414);
      --radius: 10px;
      --flip-dur: 500ms;
      --ease: cubic-bezier(.2,.7,.2,1);
    }
    * { box-sizing: border-box }
    html,body { height: 100% }
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font: 16px/1.5 system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
      display:flex;
      flex-direction:column;
      align-items:center;
    }

    .btn{
      appearance:none; border:1px solid #2a313a; background:#1b2230;
      color:var(--text); padding:.5rem .75rem; border-radius:8px; cursor:pointer;
      transition:transform .12s ease, border-color .12s ease, background .12s ease;
      display:inline-flex; align-items:center; justify-content:center;
    }
    .btn:hover{ transform:translateY(-1px); border-color:#374151; background:#20283a }
    .btn:focus{ outline:2px solid var(--accent); outline-offset:2px }
    .btn[disabled]{ opacity:.5; cursor:not-allowed }

    main{
      width:100%; max-width:var(--page-w); margin:1rem auto; padding:0; flex:1;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      gap:1rem;
      position:relative; /* keep nav buttons positioned relative to main */
    }

    .book{
      width:var(--page-w); height:var(--page-h);
      background:#0c1424; border-radius:var(--radius);
      box-shadow:0 10px 30px var(--shadow);
      position:relative; overflow:hidden;
      border:1px solid #1f2a3d;
    }
    .page{
      position:absolute; inset:0; display:grid; place-items:center;
      will-change:transform, opacity; backface-visibility:hidden;
    }
    .page img{
      max-width:100%; max-height:100%;
      width:100%; height:100%; object-fit:contain;
      background:#0b1321;
    }

    /* flip animations */
    .flip-enter{ transform: translateX(100%) rotateY(-10deg); opacity:.0; }
    .flip-enter-active{
      transition: transform var(--flip-dur) var(--ease), opacity var(--flip-dur) var(--ease);
      transform: translateX(0) rotateY(0); opacity:1;
    }
    .flip-exit{ transform: translateX(0) rotateY(0); opacity:1 }
    .flip-exit-active{
      transition: transform var(--flip-dur) var(--ease), opacity var(--flip-dur) var(--ease);
      transform: translateX(-100%) rotateY(10deg); opacity:0;
    }
    .flip-enter-rtl{ transform: translateX(-100%) rotateY(10deg); opacity:.0 }
    .flip-enter-active-rtl{
      transition: transform var(--flip-dur) var(--ease), opacity var(--flip-dur) var(--ease);
      transform: translateX(0) rotateY(0); opacity:1;
    }
    .flip-exit-rtl{ transform: translateX(0) rotateY(0); opacity:1 }
    .flip-exit-active-rtl{
      transition: transform var(--flip-dur) var(--ease), opacity var(--flip-dur) var(--ease);
      transform: translateX(100%) rotateY(-10deg); opacity:0;
    }

    /* Navigation arrows placed OUTSIDE the book (middle-left and middle-right) */
    .nav-btn{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      width:54px;
      height:54px;
      border-radius:999px;
      display:grid;
      place-items:center;
      font-size:22px;
      line-height:1;
      background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(0,0,0,0.12));
      border:1px solid rgba(255,255,255,0.06);
      box-shadow: 0 6px 18px rgba(2,6,23,0.6);
      color:var(--text);
      z-index:6;
      backdrop-filter: blur(4px);
    }
    .nav-btn:hover{ transform:translateY(-50%) scale(1.03) }
    .nav-btn:active{ transform:translateY(-50%) scale(.98) }

    /* place them outside the book using calc and the --page-w variable */
    /* Prev on the left side, outside the image */
    .nav-prev{
      left: calc(50% - (var(--page-w) / 2) - 70px);
    }
    /* Next on the right side, outside the image */
    .nav-next{
      left: calc(50% + (var(--page-w) / 2) + 16px);
    }

    /* Controls bar under the book */
    .controls{
      display:flex; align-items:center; gap:.75rem; width:100%;
      background:var(--panel); border:1px solid #20262e;
      padding:.75rem; border-radius:10px;
    }
    .counter{ font-variant-numeric: tabular-nums; color:var(--muted) }
    .slider{
      -webkit-appearance:none; appearance:none; width:100%; height:6px; border-radius:999px;
      background:#293243; outline:none;
    }
    .slider::-webkit-slider-thumb{
      -webkit-appearance:none; appearance:none; width:18px; height:18px; border-radius:50%;
      background:var(--accent); box-shadow:0 0 0 2px #111827;
      cursor:pointer;
    }
    .slider::-moz-range-thumb{
      width:18px; height:18px; border-radius:50%; background:var(--accent); border:none; cursor:pointer;
    }
    footer{
      color:var(--muted); text-align:center; padding:.5rem 1rem 1rem;
    }

    @media (prefers-reduced-motion: reduce){
      .flip-enter, .flip-enter-rtl { transform:none }
      .flip-enter-active, .flip-enter-active-rtl,
      .flip-exit-active, .flip-exit-active-rtl { transition:none }
    }

    /* Hide the outside arrow buttons on small screens (phones) */
    @media (max-width:600px){
      :root{ --page-w: 94vw; }
      .counter{ font-size:.9rem }
      .nav-btn{ display:none !important } /* hide arrows on phones */
      /* tweak controls layout on phones */
      .controls{ flex-direction:column; align-items:stretch; gap:.5rem }
    }

    /* If viewport gets narrow but not phone-size, ensure buttons don't go off-screen */
    @media (max-width:1000px) and (min-width:601px) {
      .nav-prev{
        left: 8px; /* fallback to inside viewport */
      }
      .nav-next{
        left: calc(100% - 8px - 54px); /* near right edge of main */
      }
    }
  </style>
</head>
<body>
  <main>
    <div class="book" id="book" aria-live="polite" aria-label="Book viewer"></div>

    <!-- Arrow-only navigation (placed outside the image) -->
    <button class="nav-btn nav-prev" id="btnPrev" aria-label="Previous page" title="Previous page">⟵</button>
    <button class="nav-btn nav-next" id="btnNext" aria-label="Next page" title="Next page">⟶</button>

    <div class="controls" style="max-width:var(--page-w);">
      <span class="counter" id="counter">Page 1 / 1</span>
      <input type="range" class="slider" id="slider" min="1" max="1" value="1" aria-label="Go to page" />
      <button class="btn" id="btnFirst" aria-label="First page">First</button>
      <button class="btn" id="btnLast" aria-label="Last page">Last</button>
    </div>
  </main>

  <script>
    // 1) Configure your image pages here (in order):
    const PAGES = [
      "images/page1.jpg",
      "images/page2.jpg",
      "images/page3.jpg",
      "images/page4.jpg",
      "images/page5.jpg",
      "images/page6.jpg",
      "images/page7.jpg",
      "images/page8.jpg",
      "images/page9.jpg",
      "images/page10.jpg",
      "images/page11.jpg",
      "images/page12.jpg",
      "images/page13.jpg",
      "images/page14.jpg",
      "images/page15.jpg",
      "images/page16.jpg",
      "images/page17.jpg",
      "images/page18.jpg",
      "images/page19.jpg",
      "images/page20.jpg",
      "images/page21.jpg",
      "images/page22.jpg",
      "images/page23.jpg",
      "images/page24.jpg",
      "images/page25.jpg",
      "images/page26.jpg",
      "images/page27.jpg",
      "images/page28.jpg",
      "images/page29.jpg",
      "images/page30.jpg",
      "images/page31.jpg",
      "images/page32.jpg",
      "images/page33.jpg",
      "images/page34.jpg",
      "images/page35.jpg",
      "images/page36.jpg",
      "images/page37.jpg",
      "images/page38.jpg",
      "images/page39.jpg",
      "images/page40.jpg",
      "images/page41.jpg",
      "images/page42.jpg",
      "images/page43.jpg",
      "images/page44.jpg",
      "images/page45.jpg",
      "images/page46.jpg",
      "images/page47.jpg",
      "images/page48.jpg",
      "images/page49.jpg",
      "images/page50.jpg",
      "images/page51.jpg",
      "images/page52.jpg",
      "images/page53.jpg",
      "images/page54.jpg",
      // Add more...
    ];

    // 2) Settings
    const STORAGE_KEY = "image-book-last-page";
    const bookEl = document.getElementById("book");
    const counterEl = document.getElementById("counter");
    const sliderEl = document.getElementById("slider");
    const btnPrev = document.getElementById("btnPrev");
    const btnNext = document.getElementById("btnNext");
    const btnFirst = document.getElementById("btnFirst");
    const btnLast = document.getElementById("btnLast");

    let current = 1; // 1-based
    let animating = false;

    // Initialize
    sliderEl.max = String(PAGES.length);
    restoreFromHashOrStorage();
    renderPage(null);

    // Events
    btnPrev.addEventListener("click", () => goTo(current - 1, {dir:"rtl"}));
    btnNext.addEventListener("click", () => goTo(current + 1, {dir:"ltr"}));
    btnFirst.addEventListener("click", () => goTo(1, {dir:"rtl"}));
    btnLast.addEventListener("click", () => goTo(PAGES.length, {dir:"ltr"}));
    sliderEl.addEventListener("input", e => goTo(Number(e.target.value), {dir: (Number(e.target.value) >= current ? "ltr" : "rtl")}));

    window.addEventListener("keydown", e => {
      if (e.key === "ArrowRight") goTo(current + 1, {dir:"ltr"});
      else if (e.key === "ArrowLeft") goTo(current - 1, {dir:"rtl"});
      else if (e.key === "Home") goTo(1, {dir:"rtl"});
      else if (e.key === "End") goTo(PAGES.length, {dir:"ltr"});
    });

    window.addEventListener("hashchange", () => {
      const n = pageFromHash();
      if (n) goTo(n, {dir: n >= current ? "ltr" : "rtl"});
    });

    // Touch swipe
    let touchStartX = null;
    bookEl.addEventListener("touchstart", e => {
      touchStartX = e.changedTouches[0].clientX;
    }, {passive:true});
    bookEl.addEventListener("touchend", e => {
      if (touchStartX == null) return;
      const dx = e.changedTouches[0].clientX - touchStartX;
      if (Math.abs(dx) > 40) {
        if (dx < 0) goTo(current + 1, {dir:"ltr"}); // swipe left -> next
        else goTo(current - 1, {dir:"rtl"});        // swipe right -> prev
      }
      touchStartX = null;
    }, {passive:true});

    // Helpers
    function goTo(n, {dir} = {dir:"ltr"}){
      if (animating) return;
      n = clamp(n, 1, PAGES.length);
      if (n === current) return;

      animating = true;
      const oldPage = bookEl.querySelector(".page");
      const newPage = createPage(n);

      // Prepare classes for animation
      const enterClass = dir === "rtl" ? "flip-enter-rtl" : "flip-enter";
      const enterActiveClass = dir === "rtl" ? "flip-enter-active-rtl" : "flip-enter-active";
      const exitClass = dir === "rtl" ? "flip-exit-rtl" : "flip-exit";
      const exitActiveClass = dir === "rtl" ? "flip-exit-active-rtl" : "flip-exit-active";

      newPage.classList.add(enterClass);
      bookEl.appendChild(newPage);
      // Force reflow
      void newPage.offsetWidth;
      newPage.classList.add(enterActiveClass);

      if (oldPage){
        oldPage.classList.add(exitClass);
        // Force reflow
        void oldPage.offsetWidth;
        oldPage.classList.add(exitActiveClass);
      }

      const onAnimEnd = () => {
        if (oldPage) oldPage.remove();
        newPage.classList.remove(enterClass, enterActiveClass);
        current = n;
        updateUI();
        animating = false;
        preloadNeighbors();
      };

      const dur = getComputedStyle(newPage).getPropertyValue("--flip-dur");
      const ms = parseTime(dur) || 500;
      setTimeout(onAnimEnd, ms);
      saveState();
      updateHash();
    }

    function renderPage(dir){
      const page = createPage(current);
      if (dir === "rtl") page.classList.add("flip-enter-rtl");
      else if (dir === "ltr") page.classList.add("flip-enter");
      bookEl.innerHTML = "";
      bookEl.appendChild(page);
      // settle
      requestAnimationFrame(() => {
        page.classList.add(dir === "rtl" ? "flip-enter-active-rtl" : "flip-enter-active");
        setTimeout(() => {
          page.classList.remove("flip-enter", "flip-enter-rtl", "flip-enter-active", "flip-enter-active-rtl");
        }, parseTime(getComputedStyle(page).getPropertyValue("--flip-dur")) || 500);
      });
      updateUI();
      preloadNeighbors();
    }

    function createPage(n){
      const wrap = document.createElement("div");
      wrap.className = "page";
      const img = document.createElement("img");
      img.alt = `Page ${n}`;
      img.loading = "lazy";
      img.decoding = "async";
      img.src = PAGES[n-1];
      wrap.appendChild(img);
      return wrap;
    }

    function updateUI(){
      counterEl.textContent = ` ${current}`;
      sliderEl.value = String(current);
      btnPrev.disabled = current <= 1;
      btnFirst.disabled = current <= 1;
      btnNext.disabled = current >= PAGES.length;
      btnLast.disabled = current >= PAGES.length;
      document.title = `Page ${current} • Image Book Reader`;
    }

    function preloadNeighbors(){
      const next = current + 1 <= PAGES.length ? current + 1 : null;
      const prev = current - 1 >= 1 ? current - 1 : null;
      [prev, next].forEach(n => {
        if (!n) return;
        const img = new Image();
        img.src = PAGES[n-1];
      });
    }

    function clamp(x, a, b){ return Math.max(a, Math.min(b, x)) }

    function parseTime(s){
      if (!s) return 0;
      s = String(s).trim();
      if (s.endsWith("ms")) return parseFloat(s);
      if (s.endsWith("s")) return parseFloat(s) * 1000;
      return parseFloat(s) || 0;
    }

    function saveState(){
      try { localStorage.setItem(STORAGE_KEY, String(current)); } catch {}
    }
    function loadState(){
      try {
        const v = Number(localStorage.getItem(STORAGE_KEY));
        if (Number.isFinite(v) && v >= 1 && v <= PAGES.length) return v;
      } catch {}
      return null;
    }

    function updateHash(){
      if (location.hash !== `#${current}`){
        history.replaceState(null, "", `#${current}`);
      }
    }
    function pageFromHash(){
      const n = Number((location.hash || "").replace("#",""));
      return Number.isFinite(n) && n >= 1 && n <= PAGES.length ? n : null;
    }
    function restoreFromHashOrStorage(){
      const fromHash = pageFromHash();
      const fromStore = loadState();
      current = fromHash ?? fromStore ?? 1;
      sliderEl.value = String(current);
      sliderEl.max = String(PAGES.length);
    }
  </script>
</body>
</html>
